用户组讨论

一、群主分享
1、用户概念介绍
用户，其实就是系统的使用者，一个登录账号就是一个用户，比如微博账号＼微信账号＼QQ账号等。
2、用户开户
（1）用户开户，也就用户注册，是用户系统最基本的功能。
（2）用户开户，其实就是将用户的账号信息登记到系统中的一支交易。最简单一个用户注册，至少要有一个账号，也就是用户名，现在大部分系统在设计的时候，都是手机号走天下，主推用户手机号注册，有不少公司称之为获客，由此可见，开户功能对于企业的重要性。其实，手机号看似不起眼，就是一串数，企业要的不是手机号，而是手机号后面这个真实的人，也就是客户。
（3）所以，开户必须支持手机号注册，同时为了验证手机号的有效性（此手机号归属于客户本人），要通过验证码来核实，所以，同时引深出用户系统的另外几个功能：验证码短信下发＼验证码重发＼验证码验证等功能。同时引深的内部功能还有手机号是不是已经被使用，这个手机号是不是虚拟号，是哪个运营商的，是不是在黑名单列表等。
（4）所以，一个最简单的注册接口（简易接口），至少要上送两个字段：手机号与验证码。
3、PDM模型
（1）PDM模型是这样的,手机号是通过映射关系，关联到用户。
也就是说，用户是用户，手机号是手机号，这是两个维度，用户不变，手机号可变
手机号，我们只是将它作为用户注册 和登录的标识而已，是个外部标识，比如用户可以换号，手机号也可以易主，所以，在建立用户模型时，手机号不能作为用户这个主体的系统主键，用户的系统主键我们用用户ID来标识
（2）用户表的主键是USER_ID，这是一个非常重要的表，主键将来都是要分区，分表的，设计时候很关键。
 
（3）大家看到有一个ID＿TYPE这个字段了吧，这个是预留字段，默认为手机号类型，登录标识都是手机号。

 

 
4、接口设计
（1）说完了业务，接下来说我们的接口设计和处理逻辑，先说一下接口设计，我这有模版，大家按这个模版设计就行了，类似于这样。
 
这个接口设计模版还有改进的空间，大家可以再完善一下。一个接口的要要素，在文档设计的时候，要有接口名称，功能说明，入参列表、出参列表。对于用户开户这个功能来说，我们前面已经说过了，入参有两个，一个是手机号，一个是手机动态验证码，这两个是必须的，在文档中要写明，不能为空，在编码的时候，这两个字段是要有@NotNull的注解的。有了注解后，非空字段的校验就可以由系统框架系统处理了。
5、处理逻辑
（1）接着说，我们对于短信验证码这块，做了加强，因为一个手机号在不同的场景下会收到多个验证码，所以我们加了一个token，用来标识每一次短信下发后的验证令牌，对于手机验证吧，这两个是要求系统同时上送的，
 
（2）当前端系统将请求上送到用户系统后，用户系统要进行以下处理：
1. 框架进行非空字段处理
2. 用户系统校验验证码
3. 用户系统要检查手机号是否被占用，是否在黑名单等
4. 检查通过后，用户系统将会进行一个用户实体的创建 （new一个），用户实体要素看PDM
5. 在同一个事务中将用户实体持久化到数据库，同时在用户登录标识表（性能考虑）中将手机号与用户实体对像进行关联。
6. 将处理结果及相应的实体要素（如用户号，用户状态等）返回给调用方


二、群主答疑
1、EID
a: eID出来了 需要兼容吧
A:可以，我理解为EID是客户层面上的，如同身份证号一样，理论上来说，用户系统可以支持多种账号注册方式
b: EID这个 不要考虑 了   EID是公安部三所的  公安部一所也有一套方案  目前公安部没有共识
c: eid这个是客户的一个身份属性, 可以扩展的
A:但如果引入多种方式，就要对类别进行区分，比如  13800000000 ，这个号是手机号还是QQ号呢？模型就变成了这样，用户注册和使用的时候就要多选一次
 
2、黑名单
a:黑名单我们需要自己维护还是借助外部库
A:黑名单是由风控系统推入到用户系统的

3、账户体系
a:其实账户体系是否设计成主从体系, 主账号表示个体   从账号为   手机号   或QQ号  或等等
b: 我也建议  账户体系  设计成主从体系。 手机号，QQ号，微信号，身份证 都是 主账户 的标识。
A:个体是指什么？是指现实中这个人吗？
b:个体就是自然人  唯一的身份证编号的人或者说是 属性
A:这个是客户，客户是我们后期要讲的，现在还没到这个层面上,我们现在的概念还是没有统一啊，我们现在讨论的是用户,系统的使用者，或者叫登录账户
4、用户认证
a:客户用于认证：对应一个认证通过的自然人。敏感业务需要认证到具体人，比如支付业务系统，就需要补全客户信息。 用户用于登陆：一般与登陆方式对应，比如邮箱／电话／第三方认证信息。一个客户（自然人）可以有多种登陆方式。用户主要用于登陆认证。 帐户用于操作业务：业务数据与账户直接产生关联。一个用户登陆后可以在不同业务系统中，通过账号来操作业务来产生数据。
A:先由简单说起，因为你不可能在用户注册的时候，就让用户填那么多信息，互联网模式讲究用户体验。也就是说，你只要有了手机号注册功能，基本上80~90%的获客业务就可以实现了。QQ、微信、其它的我们后面再说，有扩展方案
用户不同信息的上送，是在用户开通不同业务的时候，由于业务需要，才填入的，比如，当你与银行卡业务有关的时候 ，才会要求用户填银行卡信息，用户注册时你就让用户填银行卡信息，不是互联网思维
5、验证码
A:关于短信验证码这块异常情况是怎么处理，比如因为手机号因为触发了内部次数风控等，在上游就处理掉了还是
A: 如果触发了内部风控，会在调用短信发送接口的时候，报出风控异常，比如过于频繁＼列入黑名单等. 大家会发现，在做用户系统的时候，加入了不少风控节点，这个属于业务风控，是必须做的，否则将来有可能会成为被攻击的对像

6、token

b:验证码和token  不存数据库么？
A: 验证码和ｔｏkeｎ肯定是要存的, 在PDM的控制模块里有一张表, token是Cd_KEY. 由于发送短信验证码数据量会较大，系统会定时将已经失效或已经验证的数据，迁移到历史表，以保证查询的性能
C: token 起什么作用  用户不会受到这个字段, 标示多次点击的顺序的？
A:ｔｏｋｅｎ是系统上送的，哪个系统调用发送，发送成功后，会返给调用方一个tｏｋｅｎ，其实就是一个序列号，以区分同一个手机下发的多次短信, 短信一般都有备份通道，短信下发是通过短信平台下发的，短信平台在一个通道下发失败后，自动尝试下一个通道. 关于ｔｏｋｅｎ这块，让不让用户收到都可以，如果大家用过工行或兴业的网银的话，就会发现，你的短信里有个短信序列号
 
7、短信平台
a:短信平台有打算用哪家么
A:短信平台我们只做ｍｏｃｋ就可以了，由各公司自己实现
三、文档
这个是我们以前的团队写的，大家可以参考下
 
四、管理
A:现在需要有人来整理设计文档＼PDM＼，有人管理进度，有人同步到giｔ，有人设计接口，有人具体实现
a：大概给个时间期限 比如一个月 大家都熟悉要做什么怎么做 这要来回交流沟通很多次 然后再分工 是不是这么弄的 各位爷 呵呵
A:开源的模式和我们的全部投入时间是不一样的，我们讨论一下，看是讨论一个接口做一个，还是全部讲完再做
c:这个周末大家都可以熟悉下，梳理梳理
A:业务先行，业务不了解，接口定出来怕大家不理解
五、沟通
手机qq
